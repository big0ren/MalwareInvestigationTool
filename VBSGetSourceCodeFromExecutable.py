import subprocess
import os
import time

if not os.path.isdir("C:\Users\Administrator\Desktop\MalwareCode"):
    os.mkdir(r"C:\Users\Administrator\Desktop\MalwareCode")

RunMal = r"C:\Users\Administrator\Desktop\MalwareCode\Malrun.vbs"
SourceCode = r"C:\Users\Administrator\Desktop\MalwareCode\Mal.txt"
malwareCode = r"C:\Users\Administrator\Desktop\serial numbers.vbs"
RunMal2 = r"C:\Users\Administrator\Desktop\MalwareCode\Malrun2.vbs"
SourceCode2 = r"C:\Users\Administrator\Desktop\MalwareCode\Mal2.txt"


def foundExecute(exe, LastExe,FileName,myList,SourceCode):
    fIndex = exe.find('(') + 1
    lIndex = len(exe)

    myList[LastExe] = "' " + myList[LastExe]
    myList.insert(LastExe + 1, 'Set objFSO=CreateObject("Scripting.FileSystemObject")')
    myList.insert(LastExe + 2, 'outFile="' + SourceCode +'"')
    myList.insert(LastExe + 3, 'Set objFile = objFSO.CreateTextFile(outFile,True)')
    myList.insert(LastExe + 4, 'objFile.Write ' + exe[fIndex:lIndex -1] )
    myList.insert(LastExe + 5, 'objFile.Close')

    thefile = open(FileName, 'w')
    for item in myList:
        thefile.write("%s\n" % item)
    thefile.close()
    time.sleep(6)

def OpenFile(Filename):
    f = open(Filename,'r')
    myText =f.read()
    f.close()
    return myText

def initial(fileSource ,RunScript , fileDest):
    myList=[]
    myText = OpenFile(fileSource)
    myList = myText.split('\n')
    index = 0
    LastExe = 0
    exe = ""
    for i in myList:
            if "execute(" in i.lower().replace(' ','') :
                LastExe = index
                exe = i.rstrip()
            index = index +1

    if exe:
        foundExecute( exe,LastExe, RunScript, myList ,fileDest)
        # run the vbscript
        subprocess.call("cmd /c " + RunScript)
        print "Done!"

def CheckFileLen(Filename):
    lineCoune = 0
    with open(Filename) as f:
        for i in f.readlines():
            lineCoune = lineCoune +1
            if lineCoune == 50:
                f.close()
                return False
        f.close()
        return True


initial(malwareCode,RunMal,SourceCode)
if CheckFileLen(SourceCode):
    initial(SourceCode,RunMal2,SourceCode2)
